#  Mysql





## mysql的引擎 主要是哪两种？有什么区别



1. InnoDB

2. MyISAM

   区别：

| InnoDB支持事务                         | MyISAM不支持               |
| -------------------------------------- | -------------------------- |
| InnoDB支持外键                         | MyISAM不支持               |
| InnoDB支持行锁                         | MyISAM不支持               |
| InnoDB针对更新和插入操作有更好地安全性 | MyISAM查询性能好，速度快。 |



## 说一说数据库范式



第一范式的特点是属性不可分割。

第二范式的特点是其他属性依赖于主属性。（消除子函数依赖）

第三范式的特点是其他属性不依赖于非主属性。（消除传递依赖）







## 说一说事务的特性？

ASID

原子性

一致性

隔离性

持久性 （用日志实现）



## 说一说事务的隔离级别



读未提交 

读已提交   可以避免脏读

可重复读   可以避免脏读   不可重复读  mysql的默认事务隔离级别

串行化    可以避免 脏读 不可重复读 幻读





## 什么是MYSQL的存储过程



存储过程类似java的方法，由于sql语句是先编译后执行的，设置存储过程能让sql语句预编译好，提高运行效率 







## 说一说MYSQL的索引



Mysql索引采用了B+树的构成。B+树是个平衡多路查找树，树的层数比较少，能有效的减少IO次数，提高查找效率。



Mysql的索引分为聚集索引和非聚集索引



| 聚集索引一般用主键建立，索引的最底层的叶子结点存放的都是完整的数据记录。InnoDB引擎默认会为主键自动创建聚集索引 |      |
| ------------------------------------------------------------ | ---- |
| 非聚集索引一般用非主键建立，索引的最底层的叶子结点存放的是主键和对应列属性。用非聚集索引查询数据的完整记录要用聚集索引再查一遍，这一部也叫回表。非聚集索引也叫二级索引 |      |

优点：减少数据查找量，减少了IO次数，加快数据查找速度。 



缺点：建立索引要一定的空间 。 对表进行更新和插入和删除时需要同时维护索引，降低了修改速度 

 查找的数据量如果比较大时效率不如全表扫描 。





## 索引什么时候会失效？



查询条件中有 or

查询的条件范围超过一定百分比，mysql会优化使用全表扫描

用字符串做索引值时不加引号

不符合最左匹配原则





## 什么是最左匹配原则

就是在有复合索引的情况下，从最左边开始匹配索引。



## 说一说行锁和表锁的区别

行锁是InnoDB引擎特有的锁，是加在索引上的锁，行锁开销大，容易发生死锁，发送锁冲突（不能共存的锁共存了）的概率低。 表锁是表级的，开销小，不会发生死锁，发生锁冲突的概率高 



行锁和表锁分为读锁和写锁，读锁是共享锁，写锁是排他锁，读锁和写锁也不能共存。 

为了允许行锁和表锁共存，实现多粒度锁机制，InnoD用了意向锁。 

## 什么是MVVC

多版本并发控制 InnoDB的MVVC是在每行数记录后面保存两个隐藏列，一个存行的创建时间，一个存行的过期时间，形成一个系统版本号，在查找的时候就只查找系统版 本号小于当前事务系统版本号的行 



## 什么是间隙锁

用范围条件查询数据时，对于在条件范围内但是并不存在的纪录叫做间隙，对其加锁，防止幻读 。



## MYSQL怎么避免死锁

降低隔离级别，用索引查找数据，将事务减小 。





## 一条SQL语句在MYSQL中如何执行



1. 连接器进行身份验证和建立连接。
2. 查询缓存。
3. 分析器解析SQL语句
4. 优化器选择执行方式
5. 使用执行器执行并返回数据



## 一条SQL语句执行很慢有什么原因？

1. 网络问题，连接较长
2. 操作的表正在被其他连接进行操作，加上了锁，处于等待状态。
3. 表的数据量庞大，而SQL语句没有用索引。





## MYSQL如何优化

1. 用UTF-8MB4编码
2. 尽量不要分表
3. 减少多表关联，可以适当冗余
4. 添加索引提高查找效率
5. 读写分离
6. 不用 SELECT *





Mysql 用   binlog记录事务操作，回滚。用redolog保存缓存





